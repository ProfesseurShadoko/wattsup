
<!DOCTYPE html>
<html>
    <head>
        <title>WattsUp!</title>

        <style>
            /*
            Make page fullscreen and dark
            */
            html, body {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                background-color: #111;
                overflow: hidden; /*no scrollabr*/
            }

            /*Define some variables*/
            :root {
                --diam-outer: calc(min(100vw, 100vh) * 0.5);
                --diam-inner: calc(var(--diam-outer) * 0.9);
            }

            /*Position the two circles*/
            #circle-container {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: var(--diam-outer);
                height: var(--diam-outer);
            }

            .circle {
                position: absolute;
                top: 50%; left: 50%;
                border-radius: 50%;
                transform: translate(-50%, -50%);
            }

            .outer {
                width: var(--diam-outer);
                height: var(--diam-outer);
                background-color: rgba(255, 255, 255, 0.1);
            }

            .inner {
                width: var(--diam-inner);
                height: var(--diam-inner);
                background-color: rgba(255, 255, 255, 0.2);
            }

            #angle-display {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: calc(var(--diam-inner) * 0.2);
                text-align: center;
            }

            #info-panel {
                position: fixed;
                bottom: 1rem;
                right: 1rem;
                background: rgba(0, 0, 0, 0.6);
                color: #eee;
                font-family: monospace;
                font-size: 0.8rem;
                line-height: 1.2;
                padding: 0.5rem;
                border-radius: 0.25rem;
                pointer-events: none;
                }
                #info-panel div {
                margin: 0.2em 0;
                }

        </style>
    </head>

    <body>
        <div id="circle-container">
            <div id="circle-outer" class="circle outer"></div>
            <div id="circle-inner" class="circle inner">
                <div id="angle-display">XX%</div>
            </div>
        </div>

        <div id="info-panel">
            <div>β: <span id="info-beta">0.0°</span></div>
            <div>γ: <span id="info-gamma">0.0°</span></div>
            <div>gx: <span id="info-gx">0.00</span></div>
            <div>gy: <span id="info-gy">0.00</span></div>
        </div>

    
        
    <script>

        let offsetBeta = 0;
        let offsetGamma = 0;

        let currentBeta = 0; // without offset here --> used to define the offsets
        let currentGamma = 0; // without offset here

        function update() {
            beta = currentBeta; // rotation around x-axis
            gamma = currentGamma; // rotation around y-axis

            beta -= offsetBeta; // apply the offset to beta
            gamma -= offsetGamma; // apply the offset to gamma

            const betaRad = beta * (Math.PI / 180);
            const gammaRad = gamma * (Math.PI / 180);

            const theta = Math.acos(Math.cos(betaRad) * Math.cos(gammaRad));
            const slope = Math.round(Math.atan(theta) * 100); // slope in %

            // let' change the display of text
            const angleDisplay = document.getElementById('angle-display');
            angleDisplay.textContent = slope + '%';

            // let's compute the bubble offset
            const MAX_SHIFT = 40;
            const shiftX = Math.sin(gammaRad) * MAX_SHIFT;
            const shiftY = -Math.sin(betaRad) * MAX_SHIFT;

            const inner = document.querySelector('.inner');
            inner.style.transform = `translate(
                calc(-50% + ${shiftX}%), 
                calc(-50% + ${shiftY}%)
            )`;

            // let's update the info panel
            document.getElementById('info-beta').textContent = beta.toFixed(1) + '°';
            document.getElementById('info-gamma').textContent = gamma.toFixed(1) + '°';
            document.getElementById('info-gx').textContent = (-Math.sin(gammaRad)).toFixed(2);
            document.getElementById('info-gy').textContent = (Math.sin(betaRad)).toFixed(2);
        }


        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (event) => {
                currentBeta = event.beta || 0; // rotation around x-axis
                currentGamma = event.gamma || 0; // rotation around y-axis
                update();
            });
        }

        const innerBubble = document.querySelector('.inner');
        innerBubble.addEventListener('click', () => {
            offsetBeta = currentBeta;
            offsetGamma = currentGamma;
            console.log(`Offsets set: Beta = ${offsetBeta}, Gamma = ${offsetGamma}`);
            update();
        });

        console.log('Level script loaded');
                
    </script>

    </body>

</html>